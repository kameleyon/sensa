<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#1A517B">
    <title>SensaCall - AI Companion Chat</title>
    
    <style>
        :root {
            --primary: #1A517B;
            --primary-light: #1d7693;
            --accent: #239ba8;
            --warning: #e56b00;
            --highlight: #fcb81c;
            --bg-light: #f1f5fc;
            --neutral: #b4c4c0;
            --text-dark: #2c3e50;
            --text-light: #ffffff;
            --shadow: rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-light: #1a1a2e;
            --text-dark: #ffffff;
            --neutral: #4a5568;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            height: 100vh;
            overflow: hidden;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: var(--text-light);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px var(--shadow);
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Agent Selector */
        .agent-selector {
            background: white;
            padding: 1rem;
            border-bottom: 1px solid var(--neutral);
            overflow-x: auto;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        [data-theme="dark"] .agent-selector {
            background: #2d3748;
            border-color: #4a5568;
        }

        .agent-chip {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            background: var(--bg-light);
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .agent-chip.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .agent-chip:hover:not(.active) {
            border-color: var(--accent);
        }

        /* Mode Selector */
        .mode-selector {
            background: white;
            padding: 0.75rem;
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            border-bottom: 1px solid var(--neutral);
        }

        [data-theme="dark"] .mode-selector {
            background: #2d3748;
            border-color: #4a5568;
        }

        .mode-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: var(--bg-light);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            white-space: nowrap;
        }

        .mode-btn.active {
            background: var(--accent);
            color: white;
        }

        /* Tone Slider */
        .tone-control {
            padding: 1rem;
            background: white;
            border-bottom: 1px solid var(--neutral);
        }

        [data-theme="dark"] .tone-control {
            background: #2d3748;
            border-color: #4a5568;
        }

        .tone-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .tone-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--primary) 0%, var(--accent) 50%, var(--warning) 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .tone-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: 3px solid var(--primary);
            box-shadow: 0 2px 5px var(--shadow);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: var(--bg-light);
        }

        .message {
            display: flex;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: linear-gradient(135deg, var(--warning) 0%, var(--highlight) 100%);
        }

        .message-content {
            flex: 1;
            background: white;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px var(--shadow);
        }

        [data-theme="dark"] .message-content {
            background: #2d3748;
        }

        .message.user .message-content {
            background: var(--primary);
            color: white;
        }

        .message-header {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            opacity: 0.8;
        }

        .message-text {
            line-height: 1.5;
        }

        .typing-indicator {
            display: flex;
            gap: 0.3rem;
            padding: 0.5rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Input Area */
        .input-area {
            background: white;
            border-top: 1px solid var(--neutral);
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        [data-theme="dark"] .input-area {
            background: #2d3748;
            border-color: #4a5568;
        }

        .message-input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--neutral);
            border-radius: 8px;
            outline: none;
            font-size: 1rem;
            transition: var(--transition);
            background: transparent;
            color: var(--text-dark);
        }

        .message-input:focus {
            border-color: var(--primary);
        }

        .send-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 2rem;
        }

        .welcome-title {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            width: 100%;
            max-width: 600px;
        }

        .feature-card {
            background: white;
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 5px var(--shadow);
            transition: var(--transition);
        }

        [data-theme="dark"] .feature-card {
            background: #2d3748;
        }

        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--shadow);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .feature-name {
            font-weight: 600;
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .agent-selector, .mode-selector {
                padding: 0.5rem;
            }

            .agent-chip, .mode-btn {
                font-size: 0.85rem;
                padding: 0.4rem 0.8rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>🌟 SensaCall</h1>
            <div class="header-controls">
                <span id="connection-status" style="font-size: 0.9rem;">● Connected</span>
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span id="themeIcon">🌙</span>
                </button>
            </div>
        </header>

        <!-- Agent Selector -->
        <div class="agent-selector" id="agentSelector">
            <span style="font-weight: 600; margin-right: 0.5rem;">Agent:</span>
        </div>

        <!-- Mode Selector -->
        <div class="mode-selector" id="modeSelector">
            <button class="mode-btn active" data-mode="Vent">🌊 Vent</button>
            <button class="mode-btn" data-mode="Gossip">💬 Gossip</button>
            <button class="mode-btn" data-mode="Coach">🎯 Coach</button>
            <button class="mode-btn" data-mode="Solver">🧩 Solver</button>
            <button class="mode-btn" data-mode="Hype">🚀 Hype</button>
            <button class="mode-btn" data-mode="Advice">💡 Advice</button>
        </div>

        <!-- Tone Control -->
        <div class="tone-control">
            <div class="tone-label">
                <span>Tone: <strong id="toneValue">Balanced</strong></span>
                <span style="opacity: 0.6;">Casual ← → Professional</span>
            </div>
            <input type="range" class="tone-slider" id="toneSlider" min="0" max="100" value="50">
        </div>

        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <div class="welcome-screen" id="welcomeScreen">
                <h2 class="welcome-title">Welcome to SensaCall</h2>
                <p class="welcome-subtitle">Your AI-powered conversation companion</p>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">🤖</div>
                        <div class="feature-name">15 AI Agents</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">💬</div>
                        <div class="feature-name">6 Chat Modes</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">🎨</div>
                        <div class="feature-name">Custom Tones</div>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">⚡</div>
                        <div class="feature-name">Real-time Chat</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="input-area">
            <input 
                type="text" 
                class="message-input" 
                id="messageInput" 
                placeholder="Type your message..."
                autocomplete="off"
            >
            <button class="send-btn" id="sendBtn">
                <span>Send</span>
                <span>→</span>
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            OPENROUTER_API_KEY: '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',
            OPENROUTER_API_URL: 'https://openrouter.ai/api/v1/chat/completions',
            BACKEND_URL: 'http://localhost:3001',
            WS_URL: 'ws://localhost:3001'
        };

        // AI Agents
        const AGENTS = [
            { id: 'luna', name: 'Luna', emoji: '🌙', personality: 'Empathetic and calming' },
            { id: 'phoenix', name: 'Phoenix', emoji: '🔥', personality: 'Inspiring and transformative' },
            { id: 'sage', name: 'Sage', emoji: '🧙', personality: 'Wise and knowledgeable' },
            { id: 'zara', name: 'Zara', emoji: '⚡', personality: 'Energetic and creative' },
            { id: 'atlas', name: 'Atlas', emoji: '🌍', personality: 'Analytical and strategic' },
            { id: 'nova', name: 'Nova', emoji: '✨', personality: 'Innovative and futuristic' },
            { id: 'echo', name: 'Echo', emoji: '🎵', personality: 'Harmonious and reflective' },
            { id: 'kai', name: 'Kai', emoji: '🌊', personality: 'Adaptive and flowing' },
            { id: 'indigo', name: 'Indigo', emoji: '🔮', personality: 'Intuitive and mysterious' },
            { id: 'raven', name: 'Raven', emoji: '🦅', personality: 'Observant and direct' },
            { id: 'storm', name: 'Storm', emoji: '⛈️', personality: 'Dynamic and powerful' },
            { id: 'jade', name: 'Jade', emoji: '💎', personality: 'Balanced and grounding' },
            { id: 'blaze', name: 'Blaze', emoji: '🔥', personality: 'Passionate and motivating' },
            { id: 'river', name: 'River', emoji: '🌊', personality: 'Peaceful and flowing' },
            { id: 'cosmos', name: 'Cosmos', emoji: '🌌', personality: 'Expansive and philosophical' }
        ];

        // App State
        let currentAgent = AGENTS[0];
        let currentMode = 'Vent';
        let currentTone = 50;
        let messages = [];
        let isTyping = false;

        // Initialize App
        function initApp() {
            renderAgents();
            setupEventListeners();
            loadTheme();
            updateConnectionStatus();
        }

        // Render Agents
        function renderAgents() {
            const agentSelector = document.getElementById('agentSelector');
            const agentChips = AGENTS.map(agent => `
                <button class="agent-chip ${agent.id === currentAgent.id ? 'active' : ''}" 
                        data-agent="${agent.id}" 
                        title="${agent.personality}">
                    ${agent.emoji} ${agent.name}
                </button>
            `).join('');
            
            agentSelector.innerHTML = `
                <span style="font-weight: 600; margin-right: 0.5rem;">Agent:</span>
                ${agentChips}
            `;
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Agent Selection
            document.getElementById('agentSelector').addEventListener('click', (e) => {
                if (e.target.classList.contains('agent-chip')) {
                    selectAgent(e.target.dataset.agent);
                }
            });

            // Mode Selection
            document.getElementById('modeSelector').addEventListener('click', (e) => {
                if (e.target.classList.contains('mode-btn')) {
                    selectMode(e.target.dataset.mode);
                }
            });

            // Tone Slider
            document.getElementById('toneSlider').addEventListener('input', (e) => {
                updateTone(e.target.value);
            });

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Message Input
            const messageInput = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');

            sendBtn.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        }

        // Select Agent
        function selectAgent(agentId) {
            currentAgent = AGENTS.find(a => a.id === agentId);
            document.querySelectorAll('.agent-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.agent === agentId);
            });
        }

        // Select Mode
        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
        }

        // Update Tone
        function updateTone(value) {
            currentTone = value;
            const toneValue = document.getElementById('toneValue');
            if (value < 33) {
                toneValue.textContent = 'Casual';
            } else if (value < 66) {
                toneValue.textContent = 'Balanced';
            } else {
                toneValue.textContent = 'Professional';
            }
        }

        // Send Message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isTyping) return;

            // Hide welcome screen if visible
            const welcomeScreen = document.getElementById('welcomeScreen');
            if (welcomeScreen) {
                welcomeScreen.style.display = 'none';
            }

            // Add user message
            addMessage('user', message, 'You');
            input.value = '';

            // Show typing indicator
            showTyping();

            try {
                // Call OpenRouter API
                const response = await callOpenRouter(message);
                hideTyping();
                addMessage('agent', response, currentAgent.name);
            } catch (error) {
                console.error('Error:', error);
                hideTyping();
                addMessage('agent', 'Sorry, I encountered an error. Please try again.', currentAgent.name);
            }
        }

        // Call OpenRouter API
        async function callOpenRouter(message) {
            const systemPrompt = getSystemPrompt();
            
            const response = await fetch(CONFIG.OPENROUTER_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${CONFIG.OPENROUTER_API_KEY}`,
                    'Content-Type': 'application/json',
                    'HTTP-Referer': window.location.href,
                    'X-Title': 'SensaCall'
                },
                body: JSON.stringify({
                    model: 'meta-llama/llama-3.2-3b-instruct:free',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        ...messages.map(m => ({
                            role: m.type === 'user' ? 'user' : 'assistant',
                            content: m.text
                        })),
                        { role: 'user', content: message }
                    ],
                    temperature: 0.7 + (currentTone / 100) * 0.3,
                    max_tokens: 500
                })
            });

            if (!response.ok) {
                throw new Error('API request failed');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // Get System Prompt
        function getSystemPrompt() {
            const toneDescription = currentTone < 33 ? 'casual and friendly' : 
                                   currentTone < 66 ? 'balanced and approachable' : 
                                   'professional and thoughtful';

            return `You are ${currentAgent.name}, an AI companion with the following personality: ${currentAgent.personality}.
            
The user has selected the "${currentMode}" conversation mode:
${getModeDescription()}

Please respond in a ${toneDescription} tone. Keep responses concise but helpful, typically 2-3 sentences unless more detail is needed.
Embody your unique personality while being supportive and engaging.`;
        }

        // Get Mode Description
        function getModeDescription() {
            const descriptions = {
                'Vent': 'Listen empathetically and provide emotional support. Let the user express their feelings without judgment.',
                'Gossip': 'Be fun, engaging, and conversational. React with interest and share relatable perspectives.',
                'Coach': 'Provide motivation, guidance, and actionable advice. Help the user achieve their goals.',
                'Solver': 'Focus on problem-solving and practical solutions. Break down complex issues systematically.',
                'Hype': 'Be enthusiastic, energetic, and encouraging. Celebrate wins and boost confidence.',
                'Advice': 'Offer thoughtful, balanced guidance. Consider multiple perspectives and provide wisdom.'
            };
            return descriptions[currentMode] || descriptions['Vent'];
        }

        // Add Message to Chat
        function addMessage(type, text, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const avatar = type === 'user' ? 'U' : currentAgent.emoji;
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <div class="message-header">${sender}</div>
                    <div class="message-text">${escapeHtml(text)}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store message for context
            messages.push({ type, text, sender });
            if (messages.length > 20) {
                messages = messages.slice(-20); // Keep last 20 messages for context
            }
        }

        // Show Typing Indicator
        function showTyping() {
            isTyping = true;
            const chatContainer = document.getElementById('chatContainer');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'message agent';
            typingDiv.innerHTML = `
                <div class="message-avatar">${currentAgent.emoji}</div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Hide Typing Indicator
        function hideTyping() {
            isTyping = false;
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Theme Management
        function toggleTheme() {
            const body = document.body;
            const isDark = body.dataset.theme === 'dark';
            body.dataset.theme = isDark ? 'light' : 'dark';
            document.getElementById('themeIcon').textContent = isDark ? '🌙' : '☀️';
            localStorage.setItem('theme', body.dataset.theme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.dataset.theme = savedTheme;
            document.getElementById('themeIcon').textContent = savedTheme === 'dark' ? '☀️' : '🌙';
        }

        // Connection Status
        function updateConnectionStatus() {
            const statusEl = document.getElementById('connection-status');
            // Simulate connection check
            statusEl.textContent = '● Connected';
            statusEl.style.color = '#4caf50';
        }

        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>